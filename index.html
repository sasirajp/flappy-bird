<html>
    <body>
        <canvas id="gameCanvas" style="border: 10px solid black" id="canvas" width="1200" height="800"></canvas>
    </body>
    <script>

        async function main() {
            let canvas = document.getElementById("gameCanvas");
            let ctx = canvas.getContext("2d");
            let y = 0;
            let y_velocity = 0;
            let gravity = 9;

            let x = 100;
            let MAX_WIDTH = canvas.width;
            let MAX_HEIGHT = canvas.height;
            let TOWER_HEIGHT = 300;

            document.onkeydown = () => {
                y_velocity = -50;
            }
            document.onclick = () => {
                y_velocity = -50;
            }

            let birdX = 10;
            let birdY = y;
            let birdWidth = 60;
            let birdHeight = 60;

            let pipeX = MAX_WIDTH - x;
            let pipeY = 0;
            let pipeWidth = 100;
            let pipeHeight = TOWER_HEIGHT;
            let score = 0;

            let pipeBottomY = MAX_HEIGHT - TOWER_HEIGHT;

            function isColliding(ax, ay, aw, ah, bx, by, bw, bh) {
                return ax < bx + bw &&
                    ax + aw > bx &&
                    ay < by + bh &&
                    ay + ah > by;
            }


            while (true) {
                ctx.clearRect(0, 0, 1600, 800);
                ctx.beginPath();
                y_velocity = y_velocity + gravity * 0.33;
                y = y + y_velocity * 0.33;
                birdY = y;
                ctx.fillStyle = "red";
                ctx.rect(birdX, birdY, birdWidth, birdHeight);
                ctx.fill();



                x = x + 10;
                if(x - pipeWidth > MAX_WIDTH) {
                    x = 0;
                    score = score + 1;
                }

                let pipeX = MAX_WIDTH - x;

                



                ctx.beginPath();
                ctx.fillStyle = "green";
                ctx.rect(pipeX, pipeY, pipeWidth, TOWER_HEIGHT);
                ctx.fill();


                ctx.beginPath();
                ctx.fillStyle = "green";
                ctx.rect(pipeX, pipeBottomY, pipeWidth, TOWER_HEIGHT);
                ctx.fill();

                if (y > MAX_HEIGHT - birdHeight || y < 0) {
                    alert("Collision detected! & your score is " + score);
                    break;
                }

                if (isColliding(birdX, birdY, birdWidth, birdHeight, pipeX, pipeY, pipeWidth, pipeHeight) ||
                    isColliding(birdX, birdY, birdWidth, birdHeight, pipeX, pipeBottomY, pipeWidth, pipeHeight)) {
                    alert("Collision detected! & your score is " + score);
                    break;
                }
                
                await new Promise(r => setTimeout(r, 0.033 * 1000));
            }
        }

        main();
        
    </script>
</html>